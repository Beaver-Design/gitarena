<!DOCTYPE html>
<html>
<head>
    <!-- This tells IE to use most modern available mode.
         THIS LINE MUST COME FIRST IN HEAD SECTION -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta charset="utf-8">
<title>GH Organizer</title>
<style>
    /* This rule must come first for show/hide code to work */
    body {
        margin: 1em;
        padding: 0;
        font: 13pt arial, sans-serif;
        color: #333;
    }
    h1, h2, h3, h4, h5, h6, p {
        margin: 0;
        padding: 0;
        line-height: 1;
    }
    h1, h2, h3, h4, h5, h6 { font-weight: bold; }
    h1 { font-size: 1.728em; }
    h2 { font-size: 1.200em; }
    h3, h4, h5, h6 { font-size: 1.000em; }
    ul {
        list-style-type: none;
    }
    #sidebar {
        position: fixed;
        height: 100%;
        width: 250px;
        background-color: #ddd;
        top: 0;
        left: 0;
        overflow: scroll;
    }
    #sidebar select {
        width: 160px;
        margin: 10px;
        padding: 3px 6px;
        font-size: 1em;
        font-weight: normal;
    }
    #content {
        margin-left: 250px;
    }
    </style>
</head>
<body>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script type="text/javascript">
var orgs = ["org_foo", "org_bar"];
function update(list, id, key, type){
    var select = document.getElementById(id);
    for (i = 0; i < list.length; i++) {
        option = document.createElement(type);
        option.value = i;
        option.innerHTML = list[i][key];
        select.appendChild(option);
    };
};
function gen_list(list, key){
    var htmlText = "";
    for (i = 0; i < list.length; i++) {
        var value=list[i][key]
        htmlText += '<li id="li_' + value.split(' ').join('_') + '"">';
        htmlText += '<label><input id ="'+ value.split(' ').join('_') + '" type="checkbox">';
        htmlText += value + '</label></li>';
    };
    return htmlText
};
function update_inner(id, value) {
    var element = document.getElementById(id);
    element.innerHTML = value;
};
$(document).ready(function(){
    $.ajax({
        url: '/user',
        method: "GET",
        success: function(result){
            var user_data = JSON.parse(result);
            console.log(user_data);
            update_inner("user", user_data["login"]);
        }
    });
    $.ajax({
        url: '/orgs',
        method: "GET",
        success: function(result){
            var org_data = JSON.parse(result);
            console.log(org_data);
            var htmlText=gen_list(org_data, "login");
            $("#orgs").append(htmlText);

        }
    });
});
//let user select an organization, then update the list of teams for that
//organization.
$(document).on("click", "input:checkbox", function() {
    var checked=$(this).is(":checked");
    if(!checked)
        var blue=true;
    if(checked)
        var blue=false
    var org=$(this).attr('id');
    console.log("organization clicked: " + org);
    $.ajax({
        url: "/orgs/" + org + "/teams",
        method: "GET",
        success: function(result){
            var team_data = JSON.parse(result);
            console.log(team_data);
            var htmlText=gen_list(team_data, 'name')
            if(checked)
                $("#teams").append(htmlText)
            if(!checked)
                for(i = 0; i < team_data.length; i++) {
                    var value=team_data[i]['name']
                    $("#li_" + value.split(' ').join('_')).remove()
                };
        }
    });
});
</script>
<div id="sidebar">
    <h1>GitArena</h1>
    <h2 id="user"></h1>
    <h2>Organizations</h2>
    <ul id="orgs" style="padding-left: 20px">
    </ul>
    <div align="center"><a href="/logout">logout</a></div>
</div>
<div id="content">
    <h1>Teams</h1>
    <ul id='teams'>
    </ul>
    <h1>Repositories</h1> 
    <h1>Labels</h1>
    <h1>Milestones</h1>
    <h1>Issues</h1>
</div>
</body>
</html>