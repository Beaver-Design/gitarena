<!DOCTYPE html>
<html>
<head>
    <!-- This tells IE to use most modern available mode.
         THIS LINE MUST COME FIRST IN HEAD SECTION -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta charset="utf-8">
<title>GH Organizer</title>
<style>
    /* This rule must come first for show/hide code to work */
    body {
        margin: 1em;
        padding: 0;
        font: 13pt arial, sans-serif;
        color: #333;
    }
    h1, h2, h3, h4, h5, h6, p {
        margin: 0;
        padding: 0;
        line-height: 1;
    }
    h1, h2, h3, h4, h5, h6 { font-weight: bold; }
    h1 { font-size: 1.728em; }
    h2 { font-size: 1.200em; }
    h3, h4, h5, h6 { font-size: 1.000em; }
    ul {
        list-style-type: none;
    }
    #sidebar {
        position: fixed;
        height: 100%;
        width: 250px;
        background-color: #ddd;
        top: 0;
        left: 0;
        overflow: scroll;
    }
    #sidebar select {
        width: 160px;
        margin: 10px;
        padding: 3px 6px;
        font-size: 1em;
        font-weight: normal;
    }
    #content {
        margin-left: 250px;
    }
    #sidebar div {
    overflow: hidden;
    white-space: nowrap;
    }
    .user_info > img, p{
        display: inline-block;
    }
    </style>
</head>
<body>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script type="text/javascript">
function format_name(name, prefix=""){
    return prefix + name.split(' ').join('-')
};
function gen_list(list, key, property){
    var htmlText = "";
    for (i = 0; i < list.length; i++) {
        var value=list[i][key]
        var id=list[i]['id']
        htmlText += '<li id="' + format_name(value, 'li_') + '"">';
        htmlText += '<label id="'+ id + '">';
        htmlText += '<input id ="'+ format_name(value) + '" type="checkbox" itemprop="' + property + '">';
        htmlText += value + '</label></li>';
    };
    return htmlText
};
function update_inner(id, value) {
    var element = document.getElementById(id);
    element.innerHTML = value;
};
function update_team(org, checked){
    $.ajax({
        url: "/orgs/" + org + "/teams",
        method: "GET",
        success: function(result){
            var team_data = JSON.parse(result);
            console.log(team_data);
            var htmlText=gen_list(team_data, "name", "team")
            if(checked)
                $("#teams").append(htmlText)
            if(!checked)
                for(i = 0; i < team_data.length; i++) {
                    var value=team_data[i]['name']
                    $(format_name(value, "#li_")).remove()
                };
        }
    });
};
function update_repo(org, checked){
    $.ajax({
        url: "/orgs/" + org + "/repos",
        method: "GET",
        success: function(result){
            var repo_data = JSON.parse(result);
            console.log(repo_data);
            var htmlText=gen_list(repo_data, "name", "repo")
            if(checked)
                $("#repos").append(htmlText)
            if(!checked)
                for(i = 0; i < repo_data.length; i++) {
                    var value=repo_data[i]['name']
                    $(format_name(value, "#li_")).remove()
                };
        }
    });
};
function update_avatar(href){
    $("#avatar").attr("src", href);
};
$(document).ready(function(){
    $.ajax({
        url: '/user',
        method: "GET",
        success: function(result){
            var user_data = JSON.parse(result);
            console.log(user_data);
            update_avatar(user_data["avatar_url"]);
            update_inner("user", user_data["login"]);
            $("#user_link").attr("href", user_data["html_url"])
        }
    });
    $.ajax({
        url: '/orgs',
        method: "GET",
        success: function(result){
            var org_data = JSON.parse(result);
            console.log(org_data);
            var htmlText=gen_list(org_data, "login", "org");
            $("#orgs").append(htmlText);

        }
    });
});
//let user select an organization, then update the list of teams for that
//organization.
$(document).on("click", "input:checkbox", function() {
    var checked=$(this).is(":checked");
    var id=$(this).attr('id');
    var property=$(this).attr('itemprop')
    console.log("value clicked: " + id);
    console.log("value property: " + property);
    if(property=="org"){
        update_team(id, checked);
        update_repo(id, checked);
    };
});
</script>
<div id="sidebar">
    <h1>GitArena</h1>
    <div id="user_info">
        <a id="user_link"><img id="avatar" width="36"></img><p id="user" style="font-size:36px"></p></a>
    </div>
    <h2>Organizations</h2>
    <ul id="orgs" style="padding-left: 20px">
    </ul>
    <div align="center"><a href="/logout">logout</a></div>
</div>
<div id="content">
    <h1>Teams</h1>
        <ul id='teams'>
        </ul>
    <h1>Repositories</h1> 
        <ul id='repos'>
        </ul>
    <h1>Labels</h1>
    <h1>Milestones</h1>
    <h1>Issues</h1>
</div>
</body>
</html>